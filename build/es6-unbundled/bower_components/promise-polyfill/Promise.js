function MakePromise(a){function b(a){if('object'!==typeof this||'function'!==typeof a)throw new TypeError;this._state=null,this._value=null,this._deferreds=[],g(a,d.bind(this),f.bind(this))}function c(b){var c=this;return null===this._state?void this._deferreds.push(b):void a(function(){var a=c._state?b.onFulfilled:b.onRejected;if('function'!==typeof a)return void(c._state?b.resolve:b.reject)(c._value);var d;try{d=a(c._value)}catch(a){return void b.reject(a)}b.resolve(d)})}function d(a){try{if(a===this)throw new TypeError;if(a&&('object'===typeof a||'function'===typeof a)){var b=a.then;if('function'===typeof b)return void g(b.bind(a),d.bind(this),f.bind(this))}this._state=!0,this._value=a,e.call(this)}catch(a){f.call(this,a)}}function f(a){this._state=!1,this._value=a,e.call(this)}function e(){for(var a=0,b=this._deferreds.length;a<b;a++)c.call(this,this._deferreds[a]);this._deferreds=null}function g(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(a){if(d)return;d=!0,c(a)}}return b.prototype['catch']=function(a){return this.then(null,a)},b.prototype.then=function(a,d){var e=this;return new b(function(b,f){c.call(e,{onFulfilled:a,onRejected:d,resolve:b,reject:f})})},b.resolve=function(a){return a&&'object'===typeof a&&a.constructor===b?a:new b(function(b){b(a)})},b.reject=function(a){return new b(function(b,c){c(a)})},b}'undefined'!==typeof module&&(module.exports=MakePromise);